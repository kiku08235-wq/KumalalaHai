-- Haidz Fling GUI v5 - Fling mạnh, chọn từ danh sách, tự sửa khi chết
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Xoá GUI cũ nếu có
pcall(function() LocalPlayer.PlayerGui:FindFirstChild("HaidzFlingGui"):Destroy() end)

-- GUI
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "HaidzFlingGui"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 300, 0, 240)
frame.Position = UDim2.new(0.5, -150, 0.5, -120)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
title.Text = "Haidz Fling"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22

local dropdownToggle = Instance.new("TextButton", frame)
dropdownToggle.Size = UDim2.new(0.9, 0, 0, 30)
dropdownToggle.Position = UDim2.new(0.05, 0, 0.2, 0)
dropdownToggle.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
dropdownToggle.Text = "Chọn người chơi ↓"
dropdownToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
dropdownToggle.Font = Enum.Font.SourceSansBold
dropdownToggle.TextSize = 18

local playerList = Instance.new("ScrollingFrame", frame)
playerList.Size = UDim2.new(0.9, 0, 0.3, 0)
playerList.Position = UDim2.new(0.05, 0, 0.35, 0)
playerList.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
playerList.Visible = false
playerList.CanvasSize = UDim2.new(0, 0, 0, 0)
playerList.ScrollBarThickness = 4

local selectedPlayer = nil
local flingLoop = nil

local flingBtn = Instance.new("TextButton", frame)
flingBtn.Size = UDim2.new(0.9, 0, 0, 30)
flingBtn.Position = UDim2.new(0.05, 0, 0.7, 0)
flingBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
flingBtn.Text = "FLING"
flingBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
flingBtn.Font = Enum.Font.SourceSansBold
flingBtn.TextSize = 20

local stopBtn = Instance.new("TextButton", frame)
stopBtn.Size = UDim2.new(0.9, 0, 0, 30)
stopBtn.Position = UDim2.new(0.05, 0, 0.85, 0)
stopBtn.BackgroundColor3 = Color3.fromRGB(100, 20, 20)
stopBtn.Text = "Dừng Fling"
stopBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
stopBtn.Font = Enum.Font.SourceSansBold
stopBtn.TextSize = 18

-- Tạo danh sách player
local function updatePlayerList()
	playerList:ClearAllChildren()
	local y = 0
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			local btn = Instance.new("TextButton", playerList)
			btn.Size = UDim2.new(1, 0, 0, 25)
			btn.Position = UDim2.new(0, 0, 0, y)
			btn.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
			btn.Text = plr.Name
			btn.TextColor3 = Color3.fromRGB(255, 255, 255)
			btn.Font = Enum.Font.SourceSans
			btn.TextSize = 18
			btn.MouseButton1Click:Connect(function()
				selectedPlayer = plr
				dropdownToggle.Text = "Người chọn: " .. plr.Name .. " ↑"
				playerList.Visible = false
			end)
			y += 25
		end
	end
	playerList.CanvasSize = UDim2.new(0, 0, 0, y)
end
updatePlayerList()
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)

-- Toggle danh sách
dropdownToggle.MouseButton1Click:Connect(function()
	playerList.Visible = not playerList.Visible
	dropdownToggle.Text = playerList.Visible and "Chọn người chơi ↓" or "Chọn người chơi ↑"
end)

-- Fling xoay
local function startFling()
	if not selectedPlayer then return end
	if flingLoop then flingLoop:Disconnect() end
	local Character = LocalPlayer.Character
	if not Character then return end
	local HRP = Character:FindFirstChild("HumanoidRootPart")
	local targetChar = selectedPlayer.Character
	if not HRP or not targetChar then return end
	local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
	if not targetHRP then return end

	local angular = Instance.new("BodyAngularVelocity")
	angular.AngularVelocity = Vector3.new(0, 200, 0)
	angular.MaxTorque = Vector3.new(0, math.huge, 0)
	angular.P = math.huge
	angular.Parent = HRP

	flingLoop = RunService.Heartbeat:Connect(function()
		if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
			HRP.CFrame = selectedPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(2, 0, 0)
		end
	end)
end

-- Dừng fling
stopBtn.MouseButton1Click:Connect(function()
	if flingLoop then flingLoop:Disconnect() end
	local char = LocalPlayer.Character
	if char and char:FindFirstChild("HumanoidRootPart") then
		local hrp = char.HumanoidRootPart
		for _, v in ipairs(hrp:GetChildren()) do
			if v:IsA("BodyAngularVelocity") then
				v:Destroy()
			end
		end
	end
end)

-- Bắt đầu fling
flingBtn.MouseButton1Click:Connect(startFling)

-- Auto fix khi chết
LocalPlayer.CharacterAdded:Connect(function(char)
	char:WaitForChild("HumanoidRootPart")
	wait(1)
	if flingLoop then startFling() end
end)
